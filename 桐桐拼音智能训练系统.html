<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡æ¡æ±‰è¯­æ‹¼éŸ³æ™ºèƒ½è®­ç»ƒç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", "SimHei", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* å¯¼èˆªæ ‡ç­¾ */
        .nav-tabs {
            max-width: 1200px;
            margin: 0 auto 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            background: rgba(255,255,255,0.9);
            padding: 15px 30px;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .nav-tab.active {
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-tab:hover {
            background: white;
        }
        
        /* å±å¹•å®¹å™¨ */
        .screen {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 0 20px 20px 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .screen.active {
            display: block;
        }
        
        /* é€‰æ‹©ç•Œé¢ */
        .title {
            text-align: center;
            color: #2c3e50;
            font-size: 36px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        .mode-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 30px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .mode-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .mode-btn.random {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            grid-column: span 3;
        }
        
        .stats {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .stats h3 {
            color: #34495e;
            margin-bottom: 10px;
        }
        
        .stats ul {
            list-style: none;
            padding: 0;
        }
        
        .stats li {
            padding: 5px 0;
            color: #555;
            font-size: 14px;
        }
        
        /* è®­ç»ƒè¡¨å• */
        .training-container {
            max-width: 100%;
        }
        
        .training-header {
            text-align: center;
            margin-bottom: 20px;
            page-break-after: avoid;
        }
        
        .training-header h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .training-info {
            font-size: 14px;
            color: #666;
            margin: 10px 0;
        }
        
        .training-id {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .training-type {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .training-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .training-item {
            border: 2px solid #bdc3c7;
            padding: 10px;
            border-radius: 8px;
            background: #f8f9fa;
            min-height: 85px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .pinyin {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            color: #2c3e50;
            margin-bottom: 8px;
            font-family: "Arial", "Microsoft YaHei", sans-serif;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .checkboxes {
            display: flex;
            justify-content: center;
            gap: 12px;
            font-size: 13px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .correct {
            color: #27ae60;
            font-weight: bold;
        }
        
        .wrong {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .action-btn.success {
            background: #27ae60;
        }
        
        .action-btn.success:hover {
            background: #229954;
        }
        
        .action-btn.warning {
            background: #e67e22;
        }
        
        .action-btn.warning:hover {
            background: #d35400;
        }
        
        .action-btn.secondary {
            background: #95a5a6;
        }
        
        .action-btn.secondary:hover {
            background: #7f8c8d;
        }
        
        /* å½•å…¥ç•Œé¢ */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .input-item {
            border: 3px solid #bdc3c7;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .input-item:hover {
            border-color: #3498db;
            transform: scale(1.05);
        }
        
        .input-item.correct {
            border-color: #27ae60;
            background: #d5f4e6;
        }
        
        .input-item.wrong {
            border-color: #e74c3c;
            background: #fadbd8;
        }
        
        .input-item .pinyin {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .input-status {
            text-align: center;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .input-item.correct .input-status {
            color: #27ae60;
            font-weight: bold;
        }
        
        .input-item.wrong .input-status {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* å†å²è®°å½• */
        .history-list {
            margin: 20px 0;
        }
        
        .history-item {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .history-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-meta {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .history-stats {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }
        
        .stat-box {
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .stat-box.correct {
            background: #d5f4e6;
            color: #27ae60;
        }
        
        .stat-box.wrong {
            background: #fadbd8;
            color: #e74c3c;
        }
        
        .stat-box.rate {
            background: #dfe6e9;
            color: #2c3e50;
        }
        
        .history-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        
        .history-details.show {
            display: block;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
        }
        
        .detail-item {
            padding: 5px;
            text-align: center;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .detail-item.correct {
            background: #d5f4e6;
            color: #27ae60;
        }
        
        .detail-item.wrong {
            background: #fadbd8;
            color: #e74c3c;
        }
        
        /* æ‹¼éŸ³åº“ */
        .library-section {
            margin-bottom: 40px;
        }
        
        .library-section h2 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }
        
        .library-section h3 {
            color: #555;
            font-size: 18px;
            margin: 20px 0 10px;
        }
        
        .pinyin-showcase {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .showcase-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .showcase-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .showcase-item.shengmu {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .showcase-item.danyunmu {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .showcase-item.shuangyunmu {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .showcase-item.biyunmu {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .showcase-item.zhengti {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .library-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 30px;
        }
        
        .library-stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .library-stat-card h4 {
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .library-stat-card .count {
            font-size: 36px;
            font-weight: bold;
            color: #3498db;
        }
        
        /* OCRä¸Šä¼  */
        .upload-area {
            border: 3px dashed #bdc3c7;
            padding: 40px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: #3498db;
            background: #ecf0f1;
        }
        
        .upload-area.dragover {
            border-color: #27ae60;
            background: #d5f4e6;
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .preview-image {
            max-width: 100%;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .ocr-progress {
            display: none;
            margin: 20px 0;
        }
        
        .ocr-progress.show {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* ç»Ÿè®¡åˆ†æ */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .analytics-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        
        .analytics-card h3 {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .analytics-card .number {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        /* æ‰“å°æ ·å¼ */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .nav-tabs, .action-buttons {
                display: none !important;
            }
            
            .screen {
                box-shadow: none;
                margin: 0;
                padding: 10mm;
                max-width: 100%;
            }
            
            .training-grid {
                gap: 8px;
            }
            
            .training-item {
                padding: 8px;
                min-height: 70px;
            }
            
            .pinyin {
                font-size: 20px;
            }
        }
        
        @page {
            size: A4;
            margin: 10mm;
        }

        /* è®¾ç½®ç•Œé¢ */
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .setting-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .setting-card h3 {
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .setting-item {
            margin: 20px 0;
        }
        
        .setting-item label {
            display: block;
            color: #555;
            font-size: 16px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .setting-item input[type="text"],
        .setting-item input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .setting-item input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .setting-item .hint {
            color: #7f8c8d;
            font-size: 13px;
            margin-top: 5px;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .sync-status.success {
            background: #d5f4e6;
            color: #27ae60;
        }
        
        .sync-status.error {
            background: #fadbd8;
            color: #e74c3c;
        }
        
        .sync-status.info {
            background: #dfe6e9;
            color: #2c3e50;
        }
        
        .sync-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sync-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .sync-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .sync-button.success {
            background: #27ae60;
        }
        
        .sync-button.warning {
            background: #e67e22;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ ‡ç­¾ -->
    <div class="nav-tabs">
        <div class="nav-tab active" onclick="switchScreen('training')">ğŸ“ å¼€å§‹è®­ç»ƒ</div>
        <div class="nav-tab" onclick="switchScreen('input')">ğŸ“ å½•å…¥ç»“æœ</div>
        <div class="nav-tab" onclick="switchScreen('ocr')">ğŸ“· æ‹ç…§è¯†åˆ«</div>
        <div class="nav-tab" onclick="switchScreen('history')">ğŸ“Š å†å²è®°å½•</div>
        <div class="nav-tab" onclick="switchScreen('library')">ğŸ“š æ‹¼éŸ³åº“</div>
        <div class="nav-tab" onclick="switchScreen('settings')">âš™ï¸ è®¾ç½®</div>
    </div>

    <!-- 1. è®­ç»ƒæ¨¡å¼é€‰æ‹© -->
    <div class="screen active" id="trainingScreen">
        <div id="selectionView">
            <h1 class="title">ğŸ“ æ¡æ¡æ‹¼éŸ³è®­ç»ƒç³»ç»Ÿ</h1>
            <p class="subtitle">é€‰æ‹©è®­ç»ƒæ¨¡å¼ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆä¸€é¡µè®­ç»ƒè¡¨å•ï¼ˆ8è¡ŒÃ—4åˆ—=32ä¸ªï¼‰</p>
            
            <div class="mode-buttons">
                <button class="mode-btn" onclick="startTraining('shengmu')">
                    ğŸ“ å£°æ¯è®­ç»ƒ<br>
                    <span style="font-size: 16px; opacity: 0.9;">23ä¸ªå£°æ¯</span>
                </button>
                
                <button class="mode-btn" onclick="startTraining('danyunmu')">
                    ğŸ“ å•éŸµæ¯è®­ç»ƒ<br>
                    <span style="font-size: 16px; opacity: 0.9;">24ä¸ªï¼ˆ6Ã—4å£°è°ƒï¼‰</span>
                </button>
                
                <button class="mode-btn" onclick="startTraining('shuangyunmu')">
                    ğŸ“ å¤éŸµæ¯è®­ç»ƒ<br>
                    <span style="font-size: 16px; opacity: 0.9;">36ä¸ªï¼ˆ9Ã—4å£°è°ƒï¼‰</span>
                </button>
                
                <button class="mode-btn" onclick="startTraining('biyunmu')">
                    ğŸ“ é¼»éŸµæ¯è®­ç»ƒ<br>
                    <span style="font-size: 16px; opacity: 0.9;">36ä¸ªï¼ˆ9Ã—4å£°è°ƒï¼‰</span>
                </button>
                
                <button class="mode-btn" onclick="startTraining('zhengti')">
                    ğŸ“ æ•´ä½“è®¤è¯»<br>
                    <span style="font-size: 16px; opacity: 0.9;">64ä¸ªï¼ˆ16Ã—4å£°è°ƒï¼‰</span>
                </button>
                
                <button class="mode-btn random" onclick="startTraining('random')">
                    ğŸ² éšæœºè®­ç»ƒ<br>
                    <span style="font-size: 16px; opacity: 0.9;">æ··åˆæ‰€æœ‰å†…å®¹</span>
                </button>
            </div>
            
            <div class="stats">
                <h3>ğŸ“Š è®­ç»ƒåº“ç»Ÿè®¡</h3>
                <ul>
                    <li>âœ“ å£°æ¯ï¼š23ä¸ª</li>
                    <li>âœ“ å•éŸµæ¯ï¼ˆå«å£°è°ƒï¼‰ï¼š24ä¸ªï¼ˆ6ä¸ª Ã— 4å£°è°ƒï¼‰</li>
                    <li>âœ“ å¤éŸµæ¯ï¼ˆå«å£°è°ƒï¼‰ï¼š36ä¸ªï¼ˆ9ä¸ª Ã— 4å£°è°ƒï¼‰</li>
                    <li>âœ“ é¼»éŸµæ¯ï¼ˆå«å£°è°ƒï¼‰ï¼š36ä¸ªï¼ˆ9ä¸ª Ã— 4å£°è°ƒï¼‰</li>
                    <li>âœ“ æ•´ä½“è®¤è¯»éŸ³èŠ‚ï¼ˆå«å£°è°ƒï¼‰ï¼š64ä¸ªï¼ˆ16ä¸ª Ã— 4å£°è°ƒï¼‰</li>
                    <li>âœ“ æ€»è®¡ï¼š183ä¸ªè®­ç»ƒé¡¹</li>
                    <li>âœ“ æ¯é¡µæ˜¾ç¤ºï¼š32ä¸ªè®­ç»ƒé¡¹ï¼ˆ8è¡ŒÃ—4åˆ—ï¼‰</li>
                </ul>
            </div>
        </div>
        
        <div id="trainingView" style="display: none;">
            <div class="training-header">
                <h2>æ¡æ¡æ‹¼éŸ³è®­ç»ƒè®°å½•è¡¨</h2>
                <div class="training-info">
                    è®­ç»ƒæ—¥æœŸï¼š________å¹´____æœˆ____æ—¥ã€€ã€€è®­ç»ƒè€…ï¼š__________
                </div>
                <div class="training-id" id="trainingId"></div>
                <div class="training-type" id="trainingType"></div>
            </div>
            
            <div class="training-grid" id="trainingGrid"></div>
            
            <div class="action-buttons">
                <button class="action-btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°è¡¨å•</button>
                <button class="action-btn success" onclick="goToInput()">âœï¸ å¼€å§‹å½•å…¥ç»“æœ</button>
                <button class="action-btn" onclick="regenerate()">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
                <button class="action-btn secondary" onclick="backToSelection()">â† è¿”å›é€‰æ‹©</button>
            </div>
        </div>
    </div>

    <!-- 2. æ‰‹åŠ¨å½•å…¥ç•Œé¢ -->
    <div class="screen" id="inputScreen">
        <h1 class="title">ğŸ“ æ‰‹åŠ¨å½•å…¥è®­ç»ƒç»“æœ</h1>
        <p class="subtitle">ç‚¹å‡»æ‹¼éŸ³æ¡†é€‰æ‹©"å¯¹"æˆ–"é”™"ï¼Œå®Œæˆåä¿å­˜åˆ°ç»“æœåº“</p>
        
        <div id="inputContent">
            <p style="text-align: center; color: #7f8c8d; font-size: 16px; padding: 40px;">
                è¯·å…ˆåœ¨"å¼€å§‹è®­ç»ƒ"æ ‡ç­¾ä¸­ç”Ÿæˆè®­ç»ƒè¡¨å•
            </p>
        </div>
        
        <div class="action-buttons" id="inputActions" style="display: none;">
            <button class="action-btn success" onclick="saveResults()">ğŸ’¾ ä¿å­˜ç»“æœ</button>
            <button class="action-btn secondary" onclick="clearInput()">ğŸ”„ æ¸…é™¤é€‰æ‹©</button>
        </div>
    </div>

    <!-- 3. æ‹ç…§OCRè¯†åˆ« -->
    <div class="screen" id="ocrScreen">
        <h1 class="title">ğŸ“· æ‹ç…§è¯†åˆ«è®­ç»ƒç»“æœ</h1>
        <p class="subtitle">ä¸Šä¼ è®­ç»ƒè¡¨å•ç…§ç‰‡ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å‹¾é€‰ç»“æœ</p>
        
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">ğŸ“¸</div>
            <h3>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ç…§ç‰‡</h3>
            <p style="color: #7f8c8d; margin-top: 10px;">æ”¯æŒ JPGã€PNG æ ¼å¼</p>
            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
        </div>
        
        <img id="previewImage" class="preview-image" style="display: none;">
        
        <div class="ocr-progress" id="ocrProgress">
            <h3 style="text-align: center; color: #2c3e50; margin-bottom: 10px;">æ­£åœ¨è¯†åˆ«...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <p id="ocrStatus" style="text-align: center; color: #7f8c8d; margin-top: 10px;"></p>
        </div>
        
        <div id="ocrResults" style="display: none;">
            <h3 style="color: #2c3e50; margin: 20px 0;">è¯†åˆ«ç»“æœï¼ˆè¯·æ ¸å¯¹å¹¶ä¿®æ­£ï¼‰</h3>
            <div id="ocrResultGrid"></div>
            <div class="action-buttons">
                <button class="action-btn success" onclick="saveOCRResults()">ğŸ’¾ ç¡®è®¤å¹¶ä¿å­˜</button>
                <button class="action-btn warning" onclick="resetOCR()">ğŸ”„ é‡æ–°ä¸Šä¼ </button>
            </div>
        </div>
        
        <div class="stats" style="margin-top: 30px;">
            <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
            <ul>
                <li>1. ç¡®ä¿ç…§ç‰‡æ¸…æ™°ï¼Œå…‰çº¿å……è¶³</li>
                <li>2. å°½é‡ä¿æŒè¡¨å•å¹³æ•´ï¼Œé¿å…å€¾æ–œ</li>
                <li>3. è®­ç»ƒè¡¨å•IDè¦æ¸…æ™°å¯è§</li>
                <li>4. è¯†åˆ«åè¯·ä»”ç»†æ ¸å¯¹ç»“æœ</li>
                <li>5. OCRè¯†åˆ«å¯èƒ½ä¸å®Œå…¨å‡†ç¡®ï¼Œå»ºè®®äººå·¥å¤æ ¸</li>
            </ul>
        </div>
    </div>

    <!-- 4. å†å²è®°å½• -->
    <div class="screen" id="historyScreen">
        <h1 class="title">ğŸ“Š è®­ç»ƒå†å²è®°å½•</h1>
        
        <div class="analytics-grid" id="analyticsGrid">
            <div class="analytics-card">
                <h3>æ€»è®­ç»ƒæ¬¡æ•°</h3>
                <div class="number" id="totalTrainings">0</div>
            </div>
            <div class="analytics-card">
                <h3>æ€»è®­ç»ƒé¡¹æ•°</h3>
                <div class="number" id="totalItems">0</div>
            </div>
            <div class="analytics-card">
                <h3>å¹³å‡æ­£ç¡®ç‡</h3>
                <div class="number" id="avgAccuracy">0%</div>
            </div>
        </div>
        
        <h2 style="color: #2c3e50; margin: 30px 0 20px;">è®­ç»ƒè®°å½•åˆ—è¡¨</h2>
        <div class="history-list" id="historyList">
            <p style="text-align: center; color: #7f8c8d; padding: 40px;">æš‚æ— è®­ç»ƒè®°å½•</p>
        </div>
    </div>

    <!-- 5. æ‹¼éŸ³åº“ -->
    <div class="screen" id="libraryScreen">
        <h1 class="title">ğŸ“š å®Œæ•´æ‹¼éŸ³åº“</h1>
        <p class="subtitle">æ±‰è¯­æ‹¼éŸ³å…¨éƒ¨å†…å®¹ä¸€è§ˆ</p>
        
        <!-- å£°æ¯ -->
        <div class="library-section">
            <h2>ğŸ“ å£°æ¯ï¼ˆ23ä¸ªï¼‰</h2>
            <div class="pinyin-showcase" id="shengmuShowcase"></div>
        </div>
        
        <!-- å•éŸµæ¯ -->
        <div class="library-section">
            <h2>ğŸ“ å•éŸµæ¯ï¼ˆ6ä¸ªåŸºç¡€ Ã— 4å£°è°ƒ = 24ä¸ªï¼‰</h2>
            <h3>Ä - açš„å››ä¸ªå£°è°ƒ</h3>
            <div class="pinyin-showcase">
                <div class="showcase-item danyunmu">Ä</div>
                <div class="showcase-item danyunmu">Ã¡</div>
                <div class="showcase-item danyunmu">Ç</div>
                <div class="showcase-item danyunmu">Ã </div>
            </div>
            <h3>Å - oçš„å››ä¸ªå£°è°ƒ</h3>
            <div class="pinyin-showcase">
                <div class="showcase-item danyunmu">Å</div>
                <div class="showcase-item danyunmu">Ã³</div>
                <div class="showcase-item danyunmu">Ç’</div>
                <div class="showcase-item danyunmu">Ã²</div>
            </div>
            <h3>Ä“ - eçš„å››ä¸ªå£°è°ƒ</h3>
            <div class="pinyin-showcase">
                <div class="showcase-item danyunmu">Ä“</div>
                <div class="showcase-item danyunmu">Ã©</div>
                <div class="showcase-item danyunmu">Ä›</div>
                <div class="showcase-item danyunmu">Ã¨</div>
            </div>
            <h3>Ä« - içš„å››ä¸ªå£°è°ƒ</h3>
            <div class="pinyin-showcase">
                <div class="showcase-item danyunmu">Ä«</div>
                <div class="showcase-item danyunmu">Ã­</div>
                <div class="showcase-item danyunmu">Ç</div>
                <div class="showcase-item danyunmu">Ã¬</div>
            </div>
            <h3>Å« - uçš„å››ä¸ªå£°è°ƒ</h3>
            <div class="pinyin-showcase">
                <div class="showcase-item danyunmu">Å«</div>
                <div class="showcase-item danyunmu">Ãº</div>
                <div class="showcase-item danyunmu">Ç”</div>
                <div class="showcase-item danyunmu">Ã¹</div>
            </div>
            <h3>Ç– - Ã¼çš„å››ä¸ªå£°è°ƒ</h3>
            <div class="pinyin-showcase">
                <div class="showcase-item danyunmu">Ç–</div>
                <div class="showcase-item danyunmu">Ç˜</div>
                <div class="showcase-item danyunmu">Çš</div>
                <div class="showcase-item danyunmu">Çœ</div>
            </div>
        </div>
        
        <!-- å¤éŸµæ¯ -->
        <div class="library-section">
            <h2>ğŸ“ å¤éŸµæ¯ï¼ˆ9ä¸ªåŸºç¡€ Ã— 4å£°è°ƒ = 36ä¸ªï¼‰</h2>
            <div class="pinyin-showcase" id="shuangyunmuShowcase"></div>
        </div>
        
        <!-- é¼»éŸµæ¯ -->
        <div class="library-section">
            <h2>ğŸ“ é¼»éŸµæ¯ï¼ˆ9ä¸ªåŸºç¡€ Ã— 4å£°è°ƒ = 36ä¸ªï¼‰</h2>
            <h3>å‰é¼»éŸµæ¯ï¼ˆ5ä¸ªï¼‰</h3>
            <div class="pinyin-showcase" id="qianbiyunmuShowcase"></div>
            <h3 style="margin-top: 20px;">åé¼»éŸµæ¯ï¼ˆ4ä¸ªï¼‰</h3>
            <div class="pinyin-showcase" id="houbiyunmuShowcase"></div>
        </div>
        
        <!-- æ•´ä½“è®¤è¯»éŸ³èŠ‚ -->
        <div class="library-section">
            <h2>ğŸ“ æ•´ä½“è®¤è¯»éŸ³èŠ‚ï¼ˆ16ä¸ªåŸºç¡€ Ã— 4å£°è°ƒ = 64ä¸ªï¼‰</h2>
            <div class="pinyin-showcase" id="zhengtiShowcase"></div>
        </div>
        
        <!-- ç»Ÿè®¡æ±‡æ€» -->
        <div class="library-stats">
            <div class="library-stat-card">
                <h4>ğŸ“Š æ‹¼éŸ³åº“æ€»è§ˆ</h4>
                <div class="count">183</div>
                <p style="color: #7f8c8d; margin-top: 10px;">ä¸ªè®­ç»ƒé¡¹</p>
            </div>
            <div class="library-stat-card">
                <h4>ğŸ¯ è®­ç»ƒç»„åˆ</h4>
                <ul style="list-style: none; padding: 0; color: #555; font-size: 14px; line-height: 1.8;">
                    <li>âœ“ å£°æ¯ï¼š23ä¸ª</li>
                    <li>âœ“ å•éŸµæ¯ï¼š24ä¸ª</li>
                    <li>âœ“ å¤éŸµæ¯ï¼š36ä¸ª</li>
                    <li>âœ“ é¼»éŸµæ¯ï¼š36ä¸ª</li>
                    <li>âœ“ æ•´ä½“è®¤è¯»ï¼š64ä¸ª</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 6. è®¾ç½®ç•Œé¢ -->
    <div class="screen" id="settingsScreen">
        <h1 class="title">âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>
        <p class="subtitle">é…ç½®GitHubåŒæ­¥ï¼Œå®ç°å¤šè®¾å¤‡æ•°æ®å…±äº«</p>
        
        <div class="settings-container">
            <!-- GitHubåŒæ­¥è®¾ç½® -->
            <div class="setting-card">
                <h3>ğŸ”— GitHubæ•°æ®åŒæ­¥</h3>
                <p style="color: #7f8c8d; margin-bottom: 20px; line-height: 1.6;">
                    é…ç½®GitHub Personal Access Tokenåï¼Œæ‚¨çš„è®­ç»ƒæ•°æ®å°†è‡ªåŠ¨åŒæ­¥åˆ°GitHubä»“åº“ï¼Œ
                    åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½èƒ½è®¿é—®ç›¸åŒçš„è®­ç»ƒè®°å½•ã€‚
                </p>
                
                <div class="setting-item">
                    <label>GitHub Personal Access Token</label>
                    <input type="password" id="githubToken" placeholder="è¾“å…¥æ‚¨çš„GitHub Token">
                    <div class="hint">
                        <a href="https://github.com/settings/tokens/new" target="_blank" style="color: #3498db;">ç‚¹å‡»è¿™é‡Œåˆ›å»ºToken</a>
                        ï¼ˆéœ€è¦å‹¾é€‰ repo æƒé™ï¼‰
                    </div>
                </div>
                
                <div class="setting-item">
                    <label>GitHubç”¨æˆ·å</label>
                    <input type="text" id="githubUsername" placeholder="ä¾‹å¦‚: Jiaming-Yi" value="Jiaming-Yi">
                </div>
                
                <div class="setting-item">
                    <label>ä»“åº“åç§°</label>
                    <input type="text" id="githubRepo" placeholder="ä¾‹å¦‚: pingyinxulian" value="pingyinxulian">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="sync-button" onclick="saveGitHubConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                    <button class="sync-button success" onclick="syncToGitHub()">â˜ï¸ ä¸Šä¼ æ•°æ®åˆ°GitHub</button>
                    <button class="sync-button warning" onclick="syncFromGitHub()">â¬‡ï¸ ä»GitHubä¸‹è½½æ•°æ®</button>
                </div>
                
                <div id="syncStatus" style="display: none;" class="sync-status"></div>
            </div>
            
            <!-- æ•°æ®ç®¡ç† -->
            <div class="setting-card">
                <h3>ğŸ“¦ æ•°æ®ç®¡ç†</h3>
                
                <div class="setting-item">
                    <label>æœ¬åœ°æ•°æ®</label>
                    <div id="localDataInfo" style="color: #7f8c8d; margin: 10px 0;"></div>
                    <button class="sync-button" onclick="exportLocalData()">ğŸ“¥ å¯¼å‡ºæœ¬åœ°æ•°æ®</button>
                    <button class="sync-button warning" onclick="clearLocalData()">ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°æ•°æ®</button>
                </div>
            </div>
            
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="setting-card">
                <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
                <ol style="color: #555; line-height: 2; padding-left: 20px;">
                    <li>è®¿é—® <a href="https://github.com/settings/tokens/new" target="_blank" style="color: #3498db;">GitHub Tokené¡µé¢</a> åˆ›å»ºæ–°Token</li>
                    <li>Tokenåç§°éšæ„ï¼Œæœ‰æ•ˆæœŸå»ºè®®é€‰æ‹©90å¤©æˆ–æ›´é•¿</li>
                    <li>å‹¾é€‰ <strong>repo</strong> æƒé™ï¼ˆå®Œæ•´çš„ä»“åº“è®¿é—®æƒé™ï¼‰</li>
                    <li>ç‚¹å‡»ç”ŸæˆTokenï¼Œå¤åˆ¶Tokenï¼ˆæ³¨æ„ï¼šåªæ˜¾ç¤ºä¸€æ¬¡ï¼ï¼‰</li>
                    <li>å›åˆ°æœ¬é¡µé¢ï¼Œç²˜è´´Tokenå¹¶ä¿å­˜é…ç½®</li>
                    <li>é¦–æ¬¡ä½¿ç”¨ç‚¹å‡»"ä¸Šä¼ æ•°æ®åˆ°GitHub"</li>
                    <li>åœ¨å…¶ä»–è®¾å¤‡ä½¿ç”¨æ—¶ï¼Œç‚¹å‡»"ä»GitHubä¸‹è½½æ•°æ®"å³å¯åŒæ­¥</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // å®Œæ•´æ‹¼éŸ³åº“
        const pinyinDatabase = {
            shengmu: ['b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 'g', 'k', 'h', 'j', 'q', 'x', 'zh', 'ch', 'sh', 'r', 'z', 'c', 's', 'y', 'w'],
            
            // å•éŸµæ¯ï¼ˆ6ä¸ª Ã— 4å£°è°ƒ = 24ä¸ªï¼‰
            danyunmu: [
                'Ä', 'Ã¡', 'Ç', 'Ã ',
                'Å', 'Ã³', 'Ç’', 'Ã²',
                'Ä“', 'Ã©', 'Ä›', 'Ã¨',
                'Ä«', 'Ã­', 'Ç', 'Ã¬',
                'Å«', 'Ãº', 'Ç”', 'Ã¹',
                'Ç–', 'Ç˜', 'Çš', 'Çœ'
            ],
            
            // å¤éŸµæ¯ï¼ˆ9ä¸ª Ã— 4å£°è°ƒ = 36ä¸ªï¼‰
            shuangyunmu: [
                'Äi', 'Ã¡i', 'Çi', 'Ã i',
                'Ä“i', 'Ã©i', 'Ä›i', 'Ã¨i',
                'uÄ«', 'uÃ­', 'uÇ', 'uÃ¬',
                'Äo', 'Ã¡o', 'Ço', 'Ã o',
                'Åu', 'Ã³u', 'Ç’u', 'Ã²u',
                'iÅ«', 'iÃº', 'iÇ”', 'iÃ¹',
                'iÄ“', 'iÃ©', 'iÄ›', 'iÃ¨',
                'Ã¼Ä“', 'Ã¼Ã©', 'Ã¼Ä›', 'Ã¼Ã¨',
                'Ä“r', 'Ã©r', 'Ä›r', 'Ã¨r'
            ],
            
            // é¼»éŸµæ¯ï¼ˆ9ä¸ª Ã— 4å£°è°ƒ = 36ä¸ªï¼‰
            biyunmu: [
                'Än', 'Ã¡n', 'Çn', 'Ã n',
                'Ä“n', 'Ã©n', 'Ä›n', 'Ã¨n',
                'Ä«n', 'Ã­n', 'Çn', 'Ã¬n',
                'Å«n', 'Ãºn', 'Ç”n', 'Ã¹n',
                'Ç–n', 'Ç˜n', 'Çšn', 'Çœn',
                'Äng', 'Ã¡ng', 'Çng', 'Ã ng',
                'Ä“ng', 'Ã©ng', 'Ä›ng', 'Ã¨ng',
                'Ä«ng', 'Ã­ng', 'Çng', 'Ã¬ng',
                'Ång', 'Ã³ng', 'Ç’ng', 'Ã²ng'
            ],
            
            // æ‰€æœ‰éŸµæ¯ï¼ˆå‘åå…¼å®¹ï¼‰
            yunmuWithTones: [],
            
            zhengtiWithTones: [
                'zhÄ«', 'zhÃ­', 'zhÇ', 'zhÃ¬', 'chÄ«', 'chÃ­', 'chÇ', 'chÃ¬', 'shÄ«', 'shÃ­', 'shÇ', 'shÃ¬', 'rÄ«', 'rÃ­', 'rÇ', 'rÃ¬',
                'zÄ«', 'zÃ­', 'zÇ', 'zÃ¬', 'cÄ«', 'cÃ­', 'cÇ', 'cÃ¬', 'sÄ«', 'sÃ­', 'sÇ', 'sÃ¬', 'yÄ«', 'yÃ­', 'yÇ', 'yÃ¬',
                'wÅ«', 'wÃº', 'wÇ”', 'wÃ¹', 'yÅ«', 'yÃº', 'yÇ”', 'yÃ¹', 'yÄ“', 'yÃ©', 'yÄ›', 'yÃ¨', 'yuÄ“', 'yuÃ©', 'yuÄ›', 'yuÃ¨',
                'yuÄn', 'yuÃ¡n', 'yuÇn', 'yuÃ n', 'yÄ«n', 'yÃ­n', 'yÇn', 'yÃ¬n', 'yÅ«n', 'yÃºn', 'yÇ”n', 'yÃ¹n', 'yÄ«ng', 'yÃ­ng', 'yÇng', 'yÃ¬ng'
            ]
        };
        
        // åˆå¹¶æ‰€æœ‰éŸµæ¯ï¼ˆå‘åå…¼å®¹ï¼‰
        pinyinDatabase.yunmuWithTones = [
            ...pinyinDatabase.danyunmu,
            ...pinyinDatabase.shuangyunmu,
            ...pinyinDatabase.biyunmu
        ];
        
        let currentTraining = null;
        let inputResults = {};
        const itemsPerPage = 32; // 8è¡ŒÃ—4åˆ—
        
        // åˆ‡æ¢å±å¹•
        function switchScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            const screenMap = {
                'training': 'trainingScreen',
                'input': 'inputScreen',
                'ocr': 'ocrScreen',
                'history': 'historyScreen',
                'library': 'libraryScreen',
                'settings': 'settingsScreen'
            };
            
            document.getElementById(screenMap[screen]).classList.add('active');
            event.target.classList.add('active');
            
            if (screen === 'history') {
                loadHistory();
            } else if (screen === 'library') {
                loadLibrary();
            } else if (screen === 'settings') {
                loadGitHubConfig();
            }
        }
        
        // åŠ è½½æ‹¼éŸ³åº“
        function loadLibrary() {
            // æ˜¾ç¤ºå£°æ¯
            const shengmuContainer = document.getElementById('shengmuShowcase');
            shengmuContainer.innerHTML = '';
            pinyinDatabase.shengmu.forEach(item => {
                const div = document.createElement('div');
                div.className = 'showcase-item shengmu';
                div.textContent = item;
                shengmuContainer.appendChild(div);
            });
            
            // æ˜¾ç¤ºå¤éŸµæ¯
            const shuangyunmuContainer = document.getElementById('shuangyunmuShowcase');
            shuangyunmuContainer.innerHTML = '';
            pinyinDatabase.shuangyunmu.forEach(item => {
                const div = document.createElement('div');
                div.className = 'showcase-item shuangyunmu';
                div.textContent = item;
                shuangyunmuContainer.appendChild(div);
            });
            
            // æ˜¾ç¤ºå‰é¼»éŸµæ¯
            const qianbiContainer = document.getElementById('qianbiyunmuShowcase');
            qianbiContainer.innerHTML = '';
            const qianbiYunmu = [
                'Än', 'Ã¡n', 'Çn', 'Ã n',
                'Ä“n', 'Ã©n', 'Ä›n', 'Ã¨n',
                'Ä«n', 'Ã­n', 'Çn', 'Ã¬n',
                'Å«n', 'Ãºn', 'Ç”n', 'Ã¹n',
                'Ç–n', 'Ç˜n', 'Çšn', 'Çœn'
            ];
            qianbiYunmu.forEach(item => {
                const div = document.createElement('div');
                div.className = 'showcase-item biyunmu';
                div.textContent = item;
                qianbiContainer.appendChild(div);
            });
            
            // æ˜¾ç¤ºåé¼»éŸµæ¯
            const houbiContainer = document.getElementById('houbiyunmuShowcase');
            houbiContainer.innerHTML = '';
            const houbiYunmu = [
                'Äng', 'Ã¡ng', 'Çng', 'Ã ng',
                'Ä“ng', 'Ã©ng', 'Ä›ng', 'Ã¨ng',
                'Ä«ng', 'Ã­ng', 'Çng', 'Ã¬ng',
                'Ång', 'Ã³ng', 'Ç’ng', 'Ã²ng'
            ];
            houbiYunmu.forEach(item => {
                const div = document.createElement('div');
                div.className = 'showcase-item biyunmu';
                div.textContent = item;
                houbiContainer.appendChild(div);
            });
            
            // æ˜¾ç¤ºæ•´ä½“è®¤è¯»éŸ³èŠ‚
            const zhengtiContainer = document.getElementById('zhengtiShowcase');
            zhengtiContainer.innerHTML = '';
            pinyinDatabase.zhengtiWithTones.forEach(item => {
                const div = document.createElement('div');
                div.className = 'showcase-item zhengti';
                div.textContent = item;
                zhengtiContainer.appendChild(div);
            });
        }
        
        // å¼€å§‹è®­ç»ƒ
        function startTraining(mode) {
            let items = [];
            let typeName = '';
            
            switch(mode) {
                case 'shengmu':
                    items = [...pinyinDatabase.shengmu];
                    typeName = 'å£°æ¯è®­ç»ƒ';
                    break;
                case 'danyunmu':
                    items = [...pinyinDatabase.danyunmu];
                    typeName = 'å•éŸµæ¯è®­ç»ƒï¼ˆå¸¦å£°è°ƒï¼‰';
                    break;
                case 'shuangyunmu':
                    items = [...pinyinDatabase.shuangyunmu];
                    typeName = 'å¤éŸµæ¯è®­ç»ƒï¼ˆå¸¦å£°è°ƒï¼‰';
                    break;
                case 'biyunmu':
                    items = [...pinyinDatabase.biyunmu];
                    typeName = 'é¼»éŸµæ¯è®­ç»ƒï¼ˆå¸¦å£°è°ƒï¼‰';
                    break;
                case 'yunmu':
                    items = [...pinyinDatabase.yunmuWithTones];
                    typeName = 'éŸµæ¯è®­ç»ƒï¼ˆå¸¦å£°è°ƒï¼‰';
                    break;
                case 'zhengti':
                    items = [...pinyinDatabase.zhengtiWithTones];
                    typeName = 'æ•´ä½“è®¤è¯»éŸ³èŠ‚è®­ç»ƒ';
                    break;
                case 'random':
                    items = [...pinyinDatabase.shengmu, ...pinyinDatabase.yunmuWithTones, ...pinyinDatabase.zhengtiWithTones];
                    typeName = 'éšæœºæ··åˆè®­ç»ƒ';
                    break;
            }
            
            items = shuffleArray(items).slice(0, itemsPerPage);
            
            currentTraining = {
                id: 'T' + Date.now(),
                mode: mode,
                typeName: typeName,
                items: items,
                date: new Date().toISOString()
            };
            
            generateTrainingSheet();
            document.getElementById('selectionView').style.display = 'none';
            document.getElementById('trainingView').style.display = 'block';
        }
        
        // ç”Ÿæˆè®­ç»ƒè¡¨å•
        function generateTrainingSheet() {
            document.getElementById('trainingId').textContent = 'è®­ç»ƒç¼–å·ï¼š' + currentTraining.id;
            document.getElementById('trainingType').textContent = currentTraining.typeName;
            const grid = document.getElementById('trainingGrid');
            grid.innerHTML = '';
            
            currentTraining.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'training-item';
                div.innerHTML = `
                    <div class="pinyin">${item}</div>
                    <div class="checkboxes">
                        <label class="checkbox-item correct">
                            <input type="checkbox"> âœ“
                        </label>
                        <label class="checkbox-item wrong">
                            <input type="checkbox"> âœ—
                        </label>
                    </div>
                `;
                grid.appendChild(div);
            });
        }
        
        // å‰å¾€å½•å…¥ç•Œé¢
        function goToInput() {
            if (!currentTraining) {
                alert('è¯·å…ˆç”Ÿæˆè®­ç»ƒè¡¨å•');
                return;
            }
            
            inputResults = {};
            const content = document.getElementById('inputContent');
            content.innerHTML = '';
            
            const header = document.createElement('div');
            header.style.cssText = 'text-align: center; margin-bottom: 20px;';
            header.innerHTML = `
                <div style="color: #3498db; font-weight: bold; font-size: 14px;">${currentTraining.id}</div>
                <div style="color: #2c3e50; font-size: 18px; margin-top: 5px;">${currentTraining.typeName}</div>
            `;
            content.appendChild(header);
            
            const grid = document.createElement('div');
            grid.className = 'input-grid';
            
            currentTraining.items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'input-item';
                div.dataset.index = index;
                div.innerHTML = `
                    <div class="pinyin">${item}</div>
                    <div class="input-status">ç‚¹å‡»é€‰æ‹©</div>
                `;
                div.onclick = () => toggleInput(div, index);
                grid.appendChild(div);
            });
            
            content.appendChild(grid);
            document.getElementById('inputActions').style.display = 'flex';
            switchScreen('input');
        }
        
        // åˆ‡æ¢å½•å…¥çŠ¶æ€
        function toggleInput(element, index) {
            if (!element.classList.contains('correct') && !element.classList.contains('wrong')) {
                element.classList.add('correct');
                element.querySelector('.input-status').textContent = 'âœ“ æ­£ç¡®';
                inputResults[index] = true;
            } else if (element.classList.contains('correct')) {
                element.classList.remove('correct');
                element.classList.add('wrong');
                element.querySelector('.input-status').textContent = 'âœ— é”™è¯¯';
                inputResults[index] = false;
            } else {
                element.classList.remove('wrong');
                element.querySelector('.input-status').textContent = 'ç‚¹å‡»é€‰æ‹©';
                delete inputResults[index];
            }
        }
        
        // æ¸…é™¤å½•å…¥
        function clearInput() {
            inputResults = {};
            document.querySelectorAll('.input-item').forEach(item => {
                item.classList.remove('correct', 'wrong');
                item.querySelector('.input-status').textContent = 'ç‚¹å‡»é€‰æ‹©';
            });
        }
        
        // ä¿å­˜ç»“æœ
        function saveResults() {
            if (Object.keys(inputResults).length !== currentTraining.items.length) {
                if (!confirm('è¿˜æœ‰æœªå½•å…¥çš„é¡¹ç›®ï¼Œç¡®å®šè¦ä¿å­˜å—ï¼Ÿ')) {
                    return;
                }
            }
            
            const results = currentTraining.items.map((item, index) => ({
                pinyin: item,
                result: inputResults[index] === undefined ? null : inputResults[index]
            }));
            
            const record = {
                ...currentTraining,
                results: results,
                completedDate: new Date().toISOString()
            };
            
            saveToDatabase(record);
            alert('âœ… ä¿å­˜æˆåŠŸï¼');
            
            // å¦‚æœé…ç½®äº†GitHubï¼Œæç¤ºæ˜¯å¦è‡ªåŠ¨åŒæ­¥
            if (githubConfig.token) {
                if (confirm('æ˜¯å¦ç«‹å³åŒæ­¥åˆ°GitHubï¼Ÿ')) {
                    syncToGitHub();
                }
            }
            
            clearInput();
            switchScreen('history');
        }
        
        // ä¿å­˜åˆ°æ•°æ®åº“
        function saveToDatabase(record) {
            let database = JSON.parse(localStorage.getItem('pinyinTrainingDB') || '[]');
            database.push(record);
            localStorage.setItem('pinyinTrainingDB', JSON.stringify(database));
        }
        
        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const database = JSON.parse(localStorage.getItem('pinyinTrainingDB') || '[]');
            
            // ç»Ÿè®¡æ•°æ®
            let totalTrainings = database.length;
            let totalItems = 0;
            let totalCorrect = 0;
            
            database.forEach(record => {
                if (record.results) {
                    record.results.forEach(r => {
                        if (r.result !== null) {
                            totalItems++;
                            if (r.result) totalCorrect++;
                        }
                    });
                }
            });
            
            document.getElementById('totalTrainings').textContent = totalTrainings;
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('avgAccuracy').textContent = totalItems > 0 ? Math.round(totalCorrect / totalItems * 100) + '%' : '0%';
            
            // å†å²åˆ—è¡¨
            const list = document.getElementById('historyList');
            if (database.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 40px;">æš‚æ— è®­ç»ƒè®°å½•</p>';
                return;
            }
            
            list.innerHTML = '';
            database.reverse().forEach((record, index) => {
                const correctCount = record.results ? record.results.filter(r => r.result === true).length : 0;
                const wrongCount = record.results ? record.results.filter(r => r.result === false).length : 0;
                const total = correctCount + wrongCount;
                const rate = total > 0 ? Math.round(correctCount / total * 100) : 0;
                
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <h3>
                        <span>${record.typeName}</span>
                        <button class="action-btn" style="padding: 5px 15px; font-size: 14px;" onclick="toggleDetails(${database.length - 1 - index})">æŸ¥çœ‹è¯¦æƒ…</button>
                    </h3>
                    <div class="history-meta">
                        è®­ç»ƒç¼–å·ï¼š${record.id} | æ—¥æœŸï¼š${new Date(record.completedDate || record.date).toLocaleString('zh-CN')}
                    </div>
                    <div class="history-stats">
                        <div class="stat-box correct">âœ“ æ­£ç¡®ï¼š${correctCount}</div>
                        <div class="stat-box wrong">âœ— é”™è¯¯ï¼š${wrongCount}</div>
                        <div class="stat-box rate">æ­£ç¡®ç‡ï¼š${rate}%</div>
                    </div>
                    <div class="history-details" id="details-${database.length - 1 - index}">
                        <div class="detail-grid">
                            ${record.results ? record.results.map(r => `
                                <div class="detail-item ${r.result === true ? 'correct' : (r.result === false ? 'wrong' : '')}">${r.pinyin}</div>
                            `).join('') : ''}
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        // åˆ‡æ¢è¯¦æƒ…æ˜¾ç¤º
        function toggleDetails(index) {
            const details = document.getElementById(`details-${index}`);
            details.classList.toggle('show');
        }
        
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) processImage(file);
        });
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) processImage(file);
        }
        
        // å¤„ç†å›¾åƒ
        function processImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.getElementById('previewImage');
                img.src = e.target.result;
                img.style.display = 'block';
                
                document.getElementById('uploadArea').style.display = 'none';
                performOCR(e.target.result);
            };
            reader.readAsDataURL(file);
        }
        
        // æ‰§è¡ŒOCRè¯†åˆ«
        async function performOCR(imageData) {
            const progress = document.getElementById('ocrProgress');
            progress.classList.add('show');
            
            try {
                const worker = await Tesseract.createWorker({
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            const percent = Math.round(m.progress * 100);
                            document.getElementById('progressFill').style.width = percent + '%';
                            document.getElementById('progressFill').textContent = percent + '%';
                            document.getElementById('ocrStatus').textContent = 'æ­£åœ¨è¯†åˆ«æ–‡å­—...';
                        }
                    }
                });
                
                await worker.loadLanguage('chi_sim');
                await worker.initialize('chi_sim');
                const { data: { text } } = await worker.recognize(imageData);
                await worker.terminate();
                
                // æ¨¡æ‹Ÿç»“æœï¼ˆå®é™…éœ€è¦æ›´å¤æ‚çš„è§£æé€»è¾‘ï¼‰
                setTimeout(() => {
                    showOCRResults(text);
                }, 500);
                
            } catch (error) {
                alert('OCRè¯†åˆ«å¤±è´¥ï¼š' + error.message + '\n\nå»ºè®®ï¼š\n1. ç¡®ä¿ç…§ç‰‡æ¸…æ™°\n2. å°è¯•é‡æ–°æ‹ç…§\n3. æˆ–ä½¿ç”¨æ‰‹åŠ¨å½•å…¥åŠŸèƒ½');
                resetOCR();
            }
        }
        
        // æ˜¾ç¤ºOCRç»“æœ
        function showOCRResults(text) {
            document.getElementById('ocrProgress').classList.remove('show');
            document.getElementById('ocrResults').style.display = 'block';
            
            // è¿™é‡Œéœ€è¦å®ç°å¤æ‚çš„è§£æé€»è¾‘
            // æš‚æ—¶æç¤ºç”¨æˆ·ä½¿ç”¨æ‰‹åŠ¨å½•å…¥
            document.getElementById('ocrResultGrid').innerHTML = `
                <div style="padding: 40px; text-align: center; color: #7f8c8d;">
                    <h3 style="color: #e67e22; margin-bottom: 20px;">âš ï¸ OCRåŠŸèƒ½æ­£åœ¨å®Œå–„ä¸­</h3>
                    <p>ç”±äºè®­ç»ƒè¡¨å•æ ¼å¼çš„å¤æ‚æ€§ï¼ŒOCRè¯†åˆ«å‡†ç¡®ç‡å¯èƒ½ä¸é«˜ã€‚</p>
                    <p style="margin-top: 15px; color: #2c3e50; font-weight: bold;">å»ºè®®ä½¿ç”¨"ğŸ“ å½•å…¥ç»“æœ"åŠŸèƒ½è¿›è¡Œæ‰‹åŠ¨å½•å…¥ï¼Œå‡†ç¡®ç‡æ›´é«˜ï¼</p>
                    <p style="margin-top: 20px; font-size: 14px;">è¯†åˆ«åˆ°çš„æ–‡æœ¬ï¼ˆä¾›å‚è€ƒï¼‰ï¼š</p>
                    <pre style="background: #ecf0f1; padding: 15px; border-radius: 5px; margin-top: 10px; text-align: left; max-height: 200px; overflow-y: auto;">${text}</pre>
                </div>
            `;
        }
        
        // ä¿å­˜OCRç»“æœ
        function saveOCRResults() {
            alert('OCRåŠŸèƒ½æ­£åœ¨å®Œå–„ä¸­ï¼Œè¯·ä½¿ç”¨æ‰‹åŠ¨å½•å…¥åŠŸèƒ½');
        }
        
        // é‡ç½®OCR
        function resetOCR() {
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('previewImage').style.display = 'none';
            document.getElementById('ocrProgress').classList.remove('show');
            document.getElementById('ocrResults').style.display = 'none';
            document.getElementById('fileInput').value = '';
        }
        
        // å·¥å…·å‡½æ•°
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        function regenerate() {
            startTraining(currentTraining.mode);
        }
        
        function backToSelection() {
            document.getElementById('trainingView').style.display = 'none';
            document.getElementById('selectionView').style.display = 'block';
        }

        // GitHubé…ç½®
        let githubConfig = {
            token: localStorage.getItem('github_token') || '',
            username: localStorage.getItem('github_username') || 'Jiaming-Yi',
            repo: localStorage.getItem('github_repo') || 'pingyinxulian'
        };

        // åŠ è½½é…ç½®
        function loadGitHubConfig() {
            document.getElementById('githubToken').value = githubConfig.token;
            document.getElementById('githubUsername').value = githubConfig.username;
            document.getElementById('githubRepo').value = githubConfig.repo;
            updateLocalDataInfo();
        }

        // ä¿å­˜GitHubé…ç½®
        function saveGitHubConfig() {
            githubConfig.token = document.getElementById('githubToken').value.trim();
            githubConfig.username = document.getElementById('githubUsername').value.trim();
            githubConfig.repo = document.getElementById('githubRepo').value.trim();
            
            if (!githubConfig.token || !githubConfig.username || !githubConfig.repo) {
                showSyncStatus('error', 'âŒ è¯·å¡«å†™å®Œæ•´çš„GitHubé…ç½®ä¿¡æ¯');
                return;
            }
            
            localStorage.setItem('github_token', githubConfig.token);
            localStorage.setItem('github_username', githubConfig.username);
            localStorage.setItem('github_repo', githubConfig.repo);
            
            showSyncStatus('success', 'âœ… GitHubé…ç½®å·²ä¿å­˜');
        }

        // ä¸Šä¼ æ•°æ®åˆ°GitHub
        async function syncToGitHub() {
            if (!githubConfig.token) {
                showSyncStatus('error', 'âŒ è¯·å…ˆé…ç½®GitHub Token');
                return;
            }
            
            showSyncStatus('info', 'â³ æ­£åœ¨ä¸Šä¼ æ•°æ®åˆ°GitHub...');
            
            try {
                const database = JSON.parse(localStorage.getItem('pinyinTrainingDB') || '[]');
                const content = JSON.stringify(database, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                // å…ˆå°è¯•è·å–æ–‡ä»¶SHAï¼ˆå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼‰
                let sha = null;
                try {
                    const getResponse = await fetch(
                        `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/data/training_records.json`,
                        {
                            headers: {
                                'Authorization': `token ${githubConfig.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    if (getResponse.ok) {
                        const fileData = await getResponse.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç»§ç»­
                }
                
                // ä¸Šä¼ æ–‡ä»¶
                const uploadData = {
                    message: `æ›´æ–°è®­ç»ƒè®°å½• - ${new Date().toLocaleString('zh-CN')}`,
                    content: encodedContent,
                    branch: 'main'
                };
                
                if (sha) {
                    uploadData.sha = sha;
                }
                
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/data/training_records.json`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(uploadData)
                    }
                );
                
                if (response.ok) {
                    showSyncStatus('success', `âœ… æ•°æ®å·²æˆåŠŸä¸Šä¼ åˆ°GitHubï¼ˆ${database.length}æ¡è®°å½•ï¼‰`);
                    localStorage.setItem('last_sync_time', new Date().toISOString());
                } else {
                    const error = await response.json();
                    showSyncStatus('error', `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`);
                }
            } catch (error) {
                showSyncStatus('error', `âŒ ä¸Šä¼ å‡ºé”™: ${error.message}`);
            }
        }

        // ä»GitHubä¸‹è½½æ•°æ®
        async function syncFromGitHub() {
            if (!githubConfig.token) {
                showSyncStatus('error', 'âŒ è¯·å…ˆé…ç½®GitHub Token');
                return;
            }
            
            showSyncStatus('info', 'â³ æ­£åœ¨ä»GitHubä¸‹è½½æ•°æ®...');
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/data/training_records.json`,
                    {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.ok) {
                    const fileData = await response.json();
                    const content = decodeURIComponent(escape(atob(fileData.content)));
                    const database = JSON.parse(content);
                    
                    // åˆå¹¶æœ¬åœ°å’Œäº‘ç«¯æ•°æ®ï¼ˆå»é‡ï¼‰
                    const localDB = JSON.parse(localStorage.getItem('pinyinTrainingDB') || '[]');
                    const mergedDB = mergeTrainingData(localDB, database);
                    
                    localStorage.setItem('pinyinTrainingDB', JSON.stringify(mergedDB));
                    localStorage.setItem('last_sync_time', new Date().toISOString());
                    
                    showSyncStatus('success', `âœ… æ•°æ®å·²æˆåŠŸä»GitHubä¸‹è½½ï¼ˆ${database.length}æ¡è®°å½•ï¼Œåˆå¹¶å${mergedDB.length}æ¡ï¼‰`);
                    updateLocalDataInfo();
                    
                    if (document.getElementById('historyScreen').classList.contains('active')) {
                        loadHistory();
                    }
                } else if (response.status === 404) {
                    showSyncStatus('info', 'âš ï¸ GitHubä¸Šè¿˜æ²¡æœ‰æ•°æ®æ–‡ä»¶ï¼Œè¯·å…ˆä¸Šä¼ æ•°æ®');
                } else {
                    const error = await response.json();
                    showSyncStatus('error', `âŒ ä¸‹è½½å¤±è´¥: ${error.message}`);
                }
            } catch (error) {
                showSyncStatus('error', `âŒ ä¸‹è½½å‡ºé”™: ${error.message}`);
            }
        }

        // åˆå¹¶è®­ç»ƒæ•°æ®ï¼ˆå»é‡ï¼‰
        function mergeTrainingData(local, remote) {
            const merged = [...local];
            const existingIds = new Set(local.map(r => r.id));
            
            remote.forEach(record => {
                if (!existingIds.has(record.id)) {
                    merged.push(record);
                    existingIds.add(record.id);
                }
            });
            
            // æŒ‰æ—¥æœŸæ’åº
            merged.sort((a, b) => new Date(a.date) - new Date(b.date));
            return merged;
        }

        // æ˜¾ç¤ºåŒæ­¥çŠ¶æ€
        function showSyncStatus(type, message) {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.className = `sync-status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'flex';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // æ›´æ–°æœ¬åœ°æ•°æ®ä¿¡æ¯
        function updateLocalDataInfo() {
            const database = JSON.parse(localStorage.getItem('pinyinTrainingDB') || '[]');
            const lastSync = localStorage.getItem('last_sync_time');
            
            let info = `æœ¬åœ°å…±æœ‰ ${database.length} æ¡è®­ç»ƒè®°å½•`;
            if (lastSync) {
                info += `<br>ä¸Šæ¬¡åŒæ­¥: ${new Date(lastSync).toLocaleString('zh-CN')}`;
            }
            
            document.getElementById('localDataInfo').innerHTML = info;
        }

        // å¯¼å‡ºæœ¬åœ°æ•°æ®
        function exportLocalData() {
            const database = JSON.parse(localStorage.getItem('pinyinTrainingDB') || '[]');
            const dataStr = JSON.stringify(database, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pinyin_training_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showSyncStatus('success', 'âœ… æ•°æ®å·²å¯¼å‡º');
        }

        // æ¸…é™¤æœ¬åœ°æ•°æ®
        function clearLocalData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°è®­ç»ƒæ•°æ®å—ï¼Ÿ\n\nå»ºè®®å…ˆä¸Šä¼ åˆ°GitHubæˆ–å¯¼å‡ºå¤‡ä»½ï¼')) {
                localStorage.removeItem('pinyinTrainingDB');
                updateLocalDataInfo();
                showSyncStatus('success', 'âœ… æœ¬åœ°æ•°æ®å·²æ¸…é™¤');
            }
        }
    </script>
</body>
</html> 